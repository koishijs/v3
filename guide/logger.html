<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/koishi.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#5546a3"><title>输出与日志 | Koishi</title><meta name="description" content="">
    <link rel="modulepreload" href="/v3/assets/app.9e111ae1.js"><link rel="modulepreload" href="/v3/assets/logger.html.ca30d316.js"><link rel="modulepreload" href="/v3/assets/logger.html.e1f3d9db.js">
    <link rel="stylesheet" href="/v3/assets/style.50b5c507.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/v3/" class=""><!----><span class="site-name can-hide">Koishi</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/v3/" class="nav-link" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/guide/starter.html" class="nav-link" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/api/" class="nav-link" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/plugins/" class="nav-link" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/koishijs/koishi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/v3/" class="nav-link" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/guide/starter.html" class="nav-link" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/api/" class="nav-link" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/plugins/" class="nav-link" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/koishijs/koishi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">入门</p><ul class=""><li><!--[--><a href="/v3/guide/about.html" class="nav-link sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/starter.html" class="nav-link sidebar-item" aria-label="快速上手"><!--[--><!--]--> 快速上手 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/cli.html" class="nav-link sidebar-item" aria-label="命令行工具"><!--[--><!--]--> 命令行工具 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/docker.html" class="nav-link sidebar-item" aria-label="使用 Docker"><!--[--><!--]--> 使用 Docker <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/faq.html" class="nav-link sidebar-item" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">交互</p><ul class=""><li><!--[--><a href="/v3/guide/message.html" class="nav-link sidebar-item" aria-label="接收和发送消息"><!--[--><!--]--> 接收和发送消息 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/context.html" class="nav-link sidebar-item" aria-label="插件与上下文"><!--[--><!--]--> 插件与上下文 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">指令</p><ul class=""><li><!--[--><a href="/v3/guide/command.html" class="nav-link sidebar-item" aria-label="指令系统初探"><!--[--><!--]--> 指令系统初探 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/execute.html" class="nav-link sidebar-item" aria-label="指令的触发机制"><!--[--><!--]--> 指令的触发机制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/help.html" class="nav-link sidebar-item" aria-label="查看和编写帮助"><!--[--><!--]--> 查看和编写帮助 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/decorator.html" class="nav-link sidebar-item" aria-label="使用装饰器 (beta)"><!--[--><!--]--> 使用装饰器 (beta) <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">数据库</p><ul class=""><li><!--[--><a href="/v3/guide/database.html" class="nav-link sidebar-item" aria-label="使用数据库"><!--[--><!--]--> 使用数据库 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/manage.html" class="nav-link sidebar-item" aria-label="用户系统管理"><!--[--><!--]--> 用户系统管理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/database-support.html" class="nav-link sidebar-item" aria-label="编写数据库支持"><!--[--><!--]--> 编写数据库支持 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">高级</p><ul class=""><li><!--[--><a href="/v3/guide/lifecycle.html" class="nav-link sidebar-item" aria-label="事件与生命周期"><!--[--><!--]--> 事件与生命周期 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/guide/adapter.html" class="nav-link sidebar-item" aria-label="多账户与跨平台"><!--[--><!--]--> 多账户与跨平台 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="输出与日志"><!--[--><!--]--> 输出与日志 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#配置输出" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="配置输出"><!--[--><!--]--> 配置输出 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#控制输出等级" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="控制输出等级"><!--[--><!--]--> 控制输出等级 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#在日志中显示时间" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="在日志中显示时间"><!--[--><!--]--> 在日志中显示时间 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#命名空间" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="命名空间"><!--[--><!--]--> 命名空间 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#在插件中输出" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="在插件中输出"><!--[--><!--]--> 在插件中输出 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#过滤命名空间" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="过滤命名空间"><!--[--><!--]--> 过滤命名空间 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#配置调试输出" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="配置调试输出"><!--[--><!--]--> 配置调试输出 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#手动调用-logger" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="手动调用 Logger"><!--[--><!--]--> 手动调用 Logger <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#logger-showtime" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Logger.showTime"><!--[--><!--]--> Logger.showTime <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#logger-showdiff" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Logger.showDiff"><!--[--><!--]--> Logger.showDiff <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#logger-levels" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Logger.levels"><!--[--><!--]--> Logger.levels <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/guide/logger.html#内置的输出" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="内置的输出"><!--[--><!--]--> 内置的输出 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/v3/guide/unit-tests.html" class="nav-link sidebar-item" aria-label="单元测试"><!--[--><!--]--> 单元测试 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="输出与日志" tabindex="-1"><a class="header-anchor" href="#输出与日志" aria-hidden="true">#</a> 输出与日志</h1><p>本章主要介绍如何控制 Koishi 命令行工具的输出。</p><h2 id="配置输出" tabindex="-1"><a class="header-anchor" href="#配置输出" aria-hidden="true">#</a> 配置输出</h2><h3 id="控制输出等级" tabindex="-1"><a class="header-anchor" href="#控制输出等级" aria-hidden="true">#</a> 控制输出等级</h3><p><strong>输出等级</strong>控制了所有输出到命令行的内容的重要性。在 Koishi 内置的输出系统中，所有信息被分为了 3 种不同的等级：</p><ol><li>error, success</li><li>warning, info</li><li>debug</li></ol><p>相应地，当设置输出等级为 x 时，Koishi 只会输出重要性小于等于 x 的信息。当输出等级被设置为 0 时，Koishi 将不产生任何输出；而当输出等级被设置为 3 时，Koishi 产生的全部信息都会被显示在屏幕上（当然下面还会介绍过滤器，你可以通过手动设置过滤器减少输出。）</p><p>需要注意的是，运行时产生的错误（如请求失败，数据库访问失败等）都属于 warning，只有在创建阶段和连接阶段抛出的错误才会通过 error 输出（参见 <a href="/v3/guide/lifecycle.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" class="">生命周期</a>）。</p><p>默认情况下 Koishi 的输出等级为 2。同时你有多种方法修改这个值。</p><p>你可以在配置文件中控制输出等级：</p><div class="panel-view code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">koishi.config.js</span><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;">.</span><span style="color:#66D9EF;font-style:italic;">exports</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  logLevel: </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><p>在使用 <code>koishi start</code> 指令时，你也可以加入一个 <code>--log-level</code> 选项，它的值可以是 0~3 之间的一个整数，表示不同的输出等级。例如，<code>--log-level=0</code> 就表示不产生任何输出。</p><p>上述两种方法的功能类似，但是 CLI 选项将具有更高的优先级，这样允许你临时覆盖一些配置。</p><h3 id="在日志中显示时间" tabindex="-1"><a class="header-anchor" href="#在日志中显示时间" aria-hidden="true">#</a> 在日志中显示时间</h3><p>如果你希望在每行输出前打印当前的时间，可以使用配置项 <code>logTime</code> 或者命令行选项 <code>--log-time</code>。这个选项既可以单纯地配置，也可以传入一个字符串作为输出时间的格式。基本语法如下：</p><ul><li>yyyy: 四位数年份</li><li>yy: 年份末两位</li><li>MM: 两位数月份</li><li>dd: 两位数日期</li><li>hh: 两位数小时</li><li>mm: 两位数分钟</li><li>ss: 两位数秒</li><li>SSS: 三位数毫秒</li></ul><p>当配置为 <code>true</code> 时，这一项时的默认格式为 <code>yyyy/MM/dd hh:mm:ss</code>。</p><h2 id="命名空间" tabindex="-1"><a class="header-anchor" href="#命名空间" aria-hidden="true">#</a> 命名空间</h2><h3 id="在插件中输出" tabindex="-1"><a class="header-anchor" href="#在插件中输出" aria-hidden="true">#</a> 在插件中输出</h3><p>如果你是插件开发者，你也可以主动调用 Koishi 内置的 Logger API 来输出调试信息，这样用户就可以用上述的方法来控制你的插件的输出等级了。具体使用方法是这样的：</p><div class="panel-view code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">my-plugin.js</span><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;">.</span><span style="color:#66D9EF;font-style:italic;">exports</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> (</span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 生成一个 Logger 对象，foo 作为它的命名空间</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> logger </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> ctx.</span><span style="color:#A6E22E;">logger</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">doSomething</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 调用 logger 方法来产生输出</span></span>
<span class="line"><span style="color:#F8F8F2;">    .</span><span style="color:#A6E22E;">then</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> logger.</span><span style="color:#A6E22E;">success</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;hello&#39;</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">    .</span><span style="color:#A6E22E;">catch</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> logger.</span><span style="color:#A6E22E;">warn</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;failed&#39;</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><p>上面的这个 Logger 对象有下面的方法，它们的函数签名与 <code>console.log</code> 一致：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Logger</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">warn</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">format</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">...</span><span style="color:#FD971F;font-style:italic;">param</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">[])</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">void</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">info</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">format</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">...</span><span style="color:#FD971F;font-style:italic;">param</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">[])</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">void</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">debug</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">format</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">...</span><span style="color:#FD971F;font-style:italic;">param</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">[])</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">void</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">success</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">format</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">...</span><span style="color:#FD971F;font-style:italic;">param</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">[])</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">void</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">error</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">format</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">...</span><span style="color:#FD971F;font-style:italic;">param</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">any</span><span style="color:#F8F8F2;">[])</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">void</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="过滤命名空间" tabindex="-1"><a class="header-anchor" href="#过滤命名空间" aria-hidden="true">#</a> 过滤命名空间</h3><p>前面所说的命名空间不仅会作为输出的前缀，还能用于过滤输出。用户可以通过将 <code>logLevel</code> 配置成对象的形式，指定每一个插件产生的输出的等级，就像这样：</p><div class="panel-view code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">koishi.config.js</span><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;">.</span><span style="color:#66D9EF;font-style:italic;">exports</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  logLevel: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 基础输出等级，当没有找到对应的配置项时将使用这个值</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 如果配置了 koishi start --log-level，将覆盖这个值</span></span>
<span class="line"><span style="color:#F8F8F2;">    base: </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 过滤掉所有等级大于 2 的来自命名空间 foo 的输出</span></span>
<span class="line"><span style="color:#F8F8F2;">    foo: </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><p>Koishi 也支持多级命名空间，每一级之间用冒号分隔，你可以用下面的方式声明一个子命名空间：</p><div class="panel-view code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">plugin-foo.js</span><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;">.</span><span style="color:#66D9EF;font-style:italic;">exports</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> (</span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 这两种写法是等价的</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> logger </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> ctx.</span><span style="color:#A6E22E;">logger</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo:temp&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> logger </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> ctx.</span><span style="color:#A6E22E;">logger</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">).</span><span style="color:#A6E22E;">extend</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;temp&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 执行其他代码并使用 logger 产生输出</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><p>然后，你也可以将你的配置项具体到每一级命名空间中：</p><div class="panel-view code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">koishi.config.js</span><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;">.</span><span style="color:#66D9EF;font-style:italic;">exports</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  logLevel: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    foo: {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#88846F;">// 这里也支持配置 base，当然你也可以不写，表示继承上一级的默认等级</span></span>
<span class="line"><span style="color:#F8F8F2;">      base: </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">      temp: </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    },</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="配置调试输出" tabindex="-1"><a class="header-anchor" href="#配置调试输出" aria-hidden="true">#</a> 配置调试输出</h3><p>此外，koishi 还提供了一个 <code>--debug</code> 选项，你可以临时配置那些要以等级 3 进行输出的命名空间，中间用逗号隔开。例如，<code>--debug=onebot,foo:temp</code> 就表示输出来自 onebot 和 foo:temp 的全部内容。</p><p>同 <code>--log-level</code> 类似，这个选项也将覆盖配置文件中的相关配置。</p><h2 id="手动调用-logger" tabindex="-1"><a class="header-anchor" href="#手动调用-logger" aria-hidden="true">#</a> 手动调用 Logger</h2><p>如果你不希望使用 Koishi 的命令行工具，同时又想使用上述种种特性，你可以考虑直接调用 Logger 的底层方法来进行配置。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>由于手动调用 Logger 并不是我们所推荐的行为，本节中介绍的属性和方法不会记录在文档中，Koishi 也不会保证这些功能不会在版本更新中发生变化。在开发时，请尽量以 koishi-utils 包提供的 dts 文件，而非本页面为准。</p></div><h3 id="logger-showtime" tabindex="-1"><a class="header-anchor" href="#logger-showtime" aria-hidden="true">#</a> Logger.showTime</h3><ul><li>类型：<code>string</code></li></ul><p>对应配置项 <a href="/v3/api/app.html#options-logtime" class=""><code>logTime</code></a>，只支持字符串格式。默认值为空串。</p><h3 id="logger-showdiff" tabindex="-1"><a class="header-anchor" href="#logger-showdiff" aria-hidden="true">#</a> Logger.showDiff</h3><ul><li>类型：<code>boolean</code></li></ul><p>对应配置项 <a href="/v3/api/app.html#options-logdiff" class=""><code>logDiff</code></a>。默认值为 <code>false</code>。</p><h3 id="logger-levels" tabindex="-1"><a class="header-anchor" href="#logger-levels" aria-hidden="true">#</a> Logger.levels</h3><ul><li>类型：<code>LogLevelConfig</code></li></ul><p>对应配置项 <a href="/v3/api/app.html#options-loglevel" class=""><code>logLevel</code></a> 和 <a href="/v3/api/app.html#options-logfilter" class=""><code>logFilter</code></a>，只支持对象格式。默认值为 <code>{ base: 2 }</code>。</p><h2 id="内置的输出" tabindex="-1"><a class="header-anchor" href="#内置的输出" aria-hidden="true">#</a> 内置的输出</h2><p>Koishi 自身会产生下列类型的 logger 输出：</p><p>TODO</p><p>利用上面的方法，你可以借助 koishi 的输出对你的机器人进行调试。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/koishijs/v3/edit/docs/guide/logger.md" rel="noopener noreferrer" target="_blank" aria-label="帮助我们改善此页面"><!--[--><!--]--> 帮助我们改善此页面 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">11/16/2021, 7:34:27 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: shigma10826@gmail.com">Shigma</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/v3/guide/adapter.html" class="nav-link" aria-label="多账户与跨平台"><!--[--><!--]--> 多账户与跨平台 <!--[--><!--]--></a></span><span class="next"><a href="/v3/guide/unit-tests.html" class="nav-link" aria-label="单元测试"><!--[--><!--]--> 单元测试 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/v3/assets/app.9e111ae1.js" defer></script>
  </body>
</html>
