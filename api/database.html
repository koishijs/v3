<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/koishi.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#5546a3"><title>数据库 (Database) | Koishi</title><meta name="description" content="">
    <link rel="modulepreload" href="/v3/assets/app.9e111ae1.js"><link rel="modulepreload" href="/v3/assets/database.html.170afff4.js"><link rel="modulepreload" href="/v3/assets/database.html.b16a6b94.js">
    <link rel="stylesheet" href="/v3/assets/style.50b5c507.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/v3/" class=""><!----><span class="site-name can-hide">Koishi</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/v3/" class="nav-link" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/guide/starter.html" class="nav-link" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/api/" class="nav-link router-link-active" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/plugins/" class="nav-link" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/koishijs/koishi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/v3/" class="nav-link" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/guide/starter.html" class="nav-link" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/api/" class="nav-link router-link-active" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/v3/plugins/" class="nav-link" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/koishijs/koishi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/v3/api/" class="nav-link router-link-active sidebar-heading sidebar-item" aria-label="总览"><!--[--><!--]--> 总览 <!--[--><!--]--></a><!----><!--]--><!--[--><p class="sidebar-heading sidebar-item active">核心 API</p><ul class=""><li><!--[--><a href="/v3/api/context.html" class="nav-link sidebar-item" aria-label="上下文 (Context)"><!--[--><!--]--> 上下文 (Context) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/app.html" class="nav-link sidebar-item" aria-label="应用 (App)"><!--[--><!--]--> 应用 (App) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/bot.html" class="nav-link sidebar-item" aria-label="机器人 (Bot)"><!--[--><!--]--> 机器人 (Bot) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/events.html" class="nav-link sidebar-item" aria-label="事件 (Events)"><!--[--><!--]--> 事件 (Events) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/session.html" class="nav-link sidebar-item" aria-label="会话 (Session)"><!--[--><!--]--> 会话 (Session) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/command.html" class="nav-link sidebar-item" aria-label="指令 (Command)"><!--[--><!--]--> 指令 (Command) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/segment.html" class="nav-link sidebar-item" aria-label="消息段 (Segment)"><!--[--><!--]--> 消息段 (Segment) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="数据库 (Database)"><!--[--><!--]--> 数据库 (Database) <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/api/database.html#内置表" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="内置表"><!--[--><!--]--> 内置表 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/api/database.html#user" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="User"><!--[--><!--]--> User <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#channel" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Channel"><!--[--><!--]--> Channel <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#全局接口" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="全局接口"><!--[--><!--]--> 全局接口 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/api/database.html#user-flag-channel-flag" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="User.Flag, Channel.Flag"><!--[--><!--]--> User.Flag, Channel.Flag <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#user-fields-channel-fields" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="User.fields, Channel.fields"><!--[--><!--]--> User.fields, Channel.fields <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#user-extend-getter-channel-extend-getter" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="User.extend()"><!--[--><!--]--> User.extend() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#user-create-type-id-channel-create-type-id" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="User.create()"><!--[--><!--]--> User.create() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#database-extend-database-extension" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Database.extend()"><!--[--><!--]--> Database.extend() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#tables-extend-name-meta" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Tables.extend()"><!--[--><!--]--> Tables.extend() <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#数据类型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="数据类型"><!--[--><!--]--> 数据类型 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/api/database.html#数值类型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="数值类型"><!--[--><!--]--> 数值类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#字符串类型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="字符串类型"><!--[--><!--]--> 字符串类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#时间类型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="时间类型"><!--[--><!--]--> 时间类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#其他类型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="其他类型"><!--[--><!--]--> 其他类型 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#orm-api" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ORM API"><!--[--><!--]--> ORM API <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-get-table-query-modifier" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.get()"><!--[--><!--]--> db.get() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-remove-table-query" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.remove()"><!--[--><!--]--> db.remove() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-create-table-data" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.create()"><!--[--><!--]--> db.create() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-update-table-data-key" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.update()"><!--[--><!--]--> db.update() <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#数据库方法" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="数据库方法"><!--[--><!--]--> 数据库方法 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-getuser-type-id-modifier" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.getUser()"><!--[--><!--]--> db.getUser() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-setuser-type-id-data" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.setUser()"><!--[--><!--]--> db.setUser() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-getchannel-type-id-modifier" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.getChannel()"><!--[--><!--]--> db.getChannel() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-getassignedchannels-fields-type-assignees" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.getAssignedChannels()"><!--[--><!--]--> db.getAssignedChannels() <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/v3/api/database.html#db-setchannel-type-id-data" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="db.setChannel()"><!--[--><!--]--> db.setChannel() <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/v3/api/adapter.html" class="nav-link sidebar-item" aria-label="适配器 (Adapter)"><!--[--><!--]--> 适配器 (Adapter) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/global.html" class="nav-link sidebar-item" aria-label="其他内置 API"><!--[--><!--]--> 其他内置 API <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">其他官方包</p><ul class=""><li><!--[--><a href="/v3/api/utils.html" class="nav-link sidebar-item" aria-label="常用工具 (Utils)"><!--[--><!--]--> 常用工具 (Utils) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/test-utils.html" class="nav-link sidebar-item" aria-label="测试工具 (Test Utils)"><!--[--><!--]--> 测试工具 (Test Utils) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/adapter/onebot.html" class="nav-link sidebar-item" aria-label="平台：OneBot"><!--[--><!--]--> 平台：OneBot <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/adapter/telegram.html" class="nav-link sidebar-item" aria-label="平台：Telegram"><!--[--><!--]--> 平台：Telegram <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/adapter/discord.html" class="nav-link sidebar-item" aria-label="平台：Discord"><!--[--><!--]--> 平台：Discord <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/adapter/kaiheila.html" class="nav-link sidebar-item" aria-label="平台：Kaiheila"><!--[--><!--]--> 平台：Kaiheila <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/database/mongo.html" class="nav-link sidebar-item" aria-label="数据库：Mongo"><!--[--><!--]--> 数据库：Mongo <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/database/mysql.html" class="nav-link sidebar-item" aria-label="数据库：MySQL"><!--[--><!--]--> 数据库：MySQL <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">更新与迁移</p><ul class=""><li><!--[--><a href="/v3/api/changelog.html" class="nav-link sidebar-item" aria-label="v3 更新日志"><!--[--><!--]--> v3 更新日志 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/v3/api/migration.html" class="nav-link sidebar-item" aria-label="从旧版本迁移"><!--[--><!--]--> 从旧版本迁移 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="数据库-database" tabindex="-1"><a class="header-anchor" href="#数据库-database" aria-hidden="true">#</a> 数据库 (Database)</h1><h2 id="内置表" tabindex="-1"><a class="header-anchor" href="#内置表" aria-hidden="true">#</a> 内置表</h2><h3 id="user" tabindex="-1"><a class="header-anchor" href="#user" aria-hidden="true">#</a> User</h3><ul><li><strong>id:</strong> <code>string</code> 内部编号</li><li><strong>name:</strong> <code>string</code> 用户昵称</li><li><strong>flag:</strong> <code>number</code> 状态标签</li><li><strong>authority:</strong> <code>number</code> 用户权限</li><li><strong>usage:</strong> <code>Record&lt;string, number&gt;</code> 指令调用次数</li><li><strong>timers:</strong> <code>Record&lt;string, number&gt;</code> 指令调用时间</li></ul><h3 id="channel" tabindex="-1"><a class="header-anchor" href="#channel" aria-hidden="true">#</a> Channel</h3><ul><li><strong>id:</strong> <code>string</code> 频道标识符</li><li><strong>flag:</strong> <code>number</code> 状态标签</li><li><strong>assignee:</strong> <code>string</code> 代理者</li></ul><h2 id="全局接口" tabindex="-1"><a class="header-anchor" href="#全局接口" aria-hidden="true">#</a> 全局接口</h2><h3 id="user-flag-channel-flag" tabindex="-1"><a class="header-anchor" href="#user-flag-channel-flag" aria-hidden="true">#</a> User.Flag, Channel.Flag</h3><p>所有用户 / 频道状态标签构成的枚举类型。参见 <a href="/v3/guide/manage.html#%E7%8A%B6%E6%80%81%E6%A0%87%E7%AD%BE" class="">状态标签</a>。</p><h3 id="user-fields-channel-fields" tabindex="-1"><a class="header-anchor" href="#user-fields-channel-fields" aria-hidden="true">#</a> User.fields, Channel.fields</h3><p>所有用户 / 频道字段构成的列表。</p><h3 id="user-extend-getter-channel-extend-getter" tabindex="-1"><a class="header-anchor" href="#user-extend-getter-channel-extend-getter" aria-hidden="true">#</a> User.extend(getter), Channel.extend(getter) <span class="badge danger" style=""><!--[-->deprecated<!--]--></span></h3><ul><li><strong>getter:</strong> <code>(type: string, id: string) =&gt; object</code> 新字段的初始化函数，返回值应该是一个由要扩展的字段和它们的默认值构成的键值对</li><li>返回值: <code>void</code></li></ul><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>此接口已被弃用，请使用 <a href="#tables-extend-name-config"><code>Tables.extend()</code></a></p></div><p>扩展用户 / 频道字段。</p><h3 id="user-create-type-id-channel-create-type-id" tabindex="-1"><a class="header-anchor" href="#user-create-type-id-channel-create-type-id" aria-hidden="true">#</a> User.create(type, id), Channel.create(type, id)</h3><ul><li><strong>type:</strong> <code>string</code> 平台名</li><li><strong>id:</strong> <code>string</code> 用户 / 频道标识符</li><li>返回值: <code>User</code> / <code>Channel</code></li></ul><p>创建一个新用户 / 频道数据对象。</p><h3 id="database-extend-database-extension" tabindex="-1"><a class="header-anchor" href="#database-extend-database-extension" aria-hidden="true">#</a> Database.extend(database, extension)</h3><ul><li><strong>database:</strong> <code>string | (new () =&gt; Database)</code> 要扩展的数据库类 <ul><li>如果传入一个字符串，则会将这个模块的默认导出作为目标类</li></ul></li><li><strong>extension:</strong> <code>Partial&lt;Database&gt; | ((Database: T) =&gt; void)</code><ul><li>如果传入一个对象，则表示要添加到原型链的方法</li><li>如果传入一个函数，则会传入上述类构造器并立即执行</li></ul></li></ul><p>扩展数据库的功能。</p><p>一个 Database 对象代理了 Koishi 上下文绑定的应用实例有关的所有数据库访问。同时它具有注入特性，任何插件都可以自己定义数据库上的方法。本章主要介绍数据库的官方接口。注意：<strong>它们并不由 Koishi 自身实现，而是由每个数据库分别实现的</strong>。Koishi 只是提供了一套标准。</p><h3 id="tables-extend-name-meta" tabindex="-1"><a class="header-anchor" href="#tables-extend-name-meta" aria-hidden="true">#</a> Tables.extend(name, meta?)</h3><ul><li><strong>name:</strong> <code>string</code> 数据表名</li><li><strong>meta:</strong> <code>Table.Extension</code> 表的基本配置 <ul><li><strong>meta.primary:</strong> <code>string</code> 主键名，默认为 <code>&#39;id&#39;</code></li><li><strong>meta.unique:</strong> <code>string[]</code> 值唯一的键名列表</li><li><strong>meta.type:</strong> <code>string</code> 主键产生的方式，目前支持： <ul><li><code>incremental</code>: 检测目前最大的主键值，并增加 1 作为新的主键值，适用于数值类型的主键</li><li><code>random</code>: 产生一个随机字符串作为新的主键值，适用于字符串类型的主键</li><li>注意：如果你的主键值是用户指定的，那么你将不需要此项配置</li></ul></li><li><strong>meta.fields:</strong> <code>Record&lt;string, string | Field&gt;</code>: 字段信息，格式参照 <a href="/v3/guide/database.html#%E6%89%A9%E5%B1%95%E8%A1%A8" class="">指南</a>，类型 <code>Field</code> 见下文</li></ul></li></ul><p>扩展既有的数据表，或者定义一个新的数据表。</p><h2 id="数据类型" tabindex="-1"><a class="header-anchor" href="#数据类型" aria-hidden="true">#</a> 数据类型</h2><p>数值类型会被用于 <a href="#tables-extend-name-meta"><code>Tables.extend()</code></a>，其定义如下：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Field</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  type</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">  length</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"><span style="color:#F8F8F2;">  nullable</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">boolean</span></span>
<span class="line"><span style="color:#F8F8F2;">  initial</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><ul><li>默认情况下 <code>nullable</code> 为 <code>true</code></li><li>使用简写定义时，<code>nullable</code> 为 <code>false</code></li><li>使用完整定义时，若 <code>initial</code> 不为 <code>null</code>，则 <code>nullable</code> 默认为 <code>false</code></li><li>如果希望覆盖默认初始值的以上行为，可以将 <code>initial</code> 手动设置为 <code>null</code></li><li>在扩展表时，由于 <a href="/v3/guide/database.html#%E6%89%A9%E5%B1%95%E8%A1%A8" class="">“不可为空”问题</a>，推荐手动将扩展的字段设置为 <code>nullable: true</code></li></ul></div><h3 id="数值类型" tabindex="-1"><a class="header-anchor" href="#数值类型" aria-hidden="true">#</a> 数值类型</h3><table><thead><tr><th style="text-align:center;">名称</th><th style="text-align:center;">TS 类型</th><th style="text-align:center;">默认长度</th><th style="text-align:center;">默认初始值</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">integer</td><td style="text-align:center;"><code>number</code></td><td style="text-align:center;">10</td><td style="text-align:center;"><code>0</code></td><td style="text-align:center;">有符号整型数，长度决定了数据的范围</td></tr><tr><td style="text-align:center;">unsigned</td><td style="text-align:center;"><code>number</code></td><td style="text-align:center;">10</td><td style="text-align:center;"><code>0</code></td><td style="text-align:center;">无符号整型数，长度决定了数据的范围</td></tr><tr><td style="text-align:center;">float</td><td style="text-align:center;"><code>number</code></td><td style="text-align:center;">固定长度</td><td style="text-align:center;"><code>0</code></td><td style="text-align:center;">单精度浮点数</td></tr><tr><td style="text-align:center;">double</td><td style="text-align:center;"><code>number</code></td><td style="text-align:center;">固定长度</td><td style="text-align:center;"><code>0</code></td><td style="text-align:center;">双精度浮点数</td></tr></tbody></table><h3 id="字符串类型" tabindex="-1"><a class="header-anchor" href="#字符串类型" aria-hidden="true">#</a> 字符串类型</h3><table><thead><tr><th style="text-align:center;">名称</th><th style="text-align:center;">TS 类型</th><th style="text-align:center;">默认长度</th><th style="text-align:center;">默认初始值</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">char</td><td style="text-align:center;"><code>string</code></td><td style="text-align:center;">64</td><td style="text-align:center;"><code>&#39;&#39;</code></td><td style="text-align:center;">定长的字符串</td></tr><tr><td style="text-align:center;">string</td><td style="text-align:center;"><code>string</code></td><td style="text-align:center;">256</td><td style="text-align:center;"><code>&#39;&#39;</code></td><td style="text-align:center;">变长的字符串</td></tr><tr><td style="text-align:center;">text</td><td style="text-align:center;"><code>string</code></td><td style="text-align:center;">65535</td><td style="text-align:center;"><code>&#39;&#39;</code></td><td style="text-align:center;">变长的字符串</td></tr></tbody></table><h3 id="时间类型" tabindex="-1"><a class="header-anchor" href="#时间类型" aria-hidden="true">#</a> 时间类型</h3><table><thead><tr><th style="text-align:center;">名称</th><th style="text-align:center;">TS 类型</th><th style="text-align:center;">默认长度</th><th style="text-align:center;">默认初始值</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">date</td><td style="text-align:center;"><code>Date</code></td><td style="text-align:center;">固定长度</td><td style="text-align:center;"><code>null</code></td><td style="text-align:center;">日期值</td></tr><tr><td style="text-align:center;">time</td><td style="text-align:center;"><code>Date</code></td><td style="text-align:center;">固定长度</td><td style="text-align:center;"><code>null</code></td><td style="text-align:center;">时间值</td></tr><tr><td style="text-align:center;">timestamp</td><td style="text-align:center;"><code>Date</code></td><td style="text-align:center;">固定长度</td><td style="text-align:center;"><code>null</code></td><td style="text-align:center;">时间戳</td></tr></tbody></table><h3 id="其他类型" tabindex="-1"><a class="header-anchor" href="#其他类型" aria-hidden="true">#</a> 其他类型</h3><table><thead><tr><th style="text-align:center;">名称</th><th style="text-align:center;">TS 类型</th><th style="text-align:center;">默认长度</th><th style="text-align:center;">默认初始值</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">json</td><td style="text-align:center;"><code>object</code></td><td style="text-align:center;">65535</td><td style="text-align:center;"><code>null</code></td><td style="text-align:center;">可被序列化为 json 的结构化数据</td></tr><tr><td style="text-align:center;">list</td><td style="text-align:center;"><code>string[]</code></td><td style="text-align:center;">65535</td><td style="text-align:center;"><code>[]</code></td><td style="text-align:center;">字符串构成的列表，序列化时以逗号分隔</td></tr></tbody></table><h2 id="orm-api" tabindex="-1"><a class="header-anchor" href="#orm-api" aria-hidden="true">#</a> ORM API</h2><h3 id="db-get-table-query-modifier" tabindex="-1"><a class="header-anchor" href="#db-get-table-query-modifier" aria-hidden="true">#</a> db.get(table, query, modifier?)</h3><ul><li><strong>table:</strong> <code>keyof Tables</code> 注册在 ORM 中的表名</li><li><strong>query:</strong> <code>QueryExpr&lt;Tables[T]&gt; | QueryShorthand</code> 搜索表达式</li><li><strong>modifier:</strong> <code>QueryModifier&lt;keyof Tables[T]&gt;</code> 请求修饰符</li><li>返回值: <code>Promise&lt;Tables[T][]&gt;</code> 用户数据</li></ul><p><a href="/v3/guide/database.html#%E8%8E%B7%E5%8F%96%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE" class="">获取</a> 数据库中的数据。</p><p>参数 query 支持正则以及表达式，你可以使用复杂的嵌套更细致化的去完成你对数据库的查找服务。实现上与 mongo 近似，如果你有使用过 mongodb 经验，那么使用 Koishi ORM 对你来说便不是一件难事。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">FieldQueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  $regex</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">RegExp</span></span>
<span class="line"><span style="color:#F8F8F2;">  $in</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">  $nin</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">  $eq</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">  $ne</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">  $gt</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">  $gte</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">  $lt</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">  $lte</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">LogicalQueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  $or</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt;[]</span></span>
<span class="line"><span style="color:#F8F8F2;">  $and</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt;[]</span></span>
<span class="line"><span style="color:#F8F8F2;">  $not</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">type</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryShorthand</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">[] </span><span style="color:#F92672;">|</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">RegExp</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">type</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">FieldQuery</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">FieldQueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">|</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryShorthand</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">type</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">LogicalQueryExpr</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">&amp;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  [</span><span style="color:#A6E22E;text-decoration:underline;">K</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">keyof</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">]</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">FieldQuery</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">[</span><span style="color:#A6E22E;text-decoration:underline;">K</span><span style="color:#F8F8F2;">]&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  limit</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"><span style="color:#F8F8F2;">  offset</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"><span style="color:#F8F8F2;">  fields</span><span style="color:#F92672;">?:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">type</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryModifier</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">[] </span><span style="color:#F92672;">|</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">QueryOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">T</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><p>下面是一些简单的示例</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;">// 获取名为 schedule 的表中 id 为 1 或者 2 的数据行</span></span>
<span class="line"><span style="color:#88846F;">// Koishi ORM 自动解析你的 primary key</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> ctx.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;schedule&#39;</span><span style="color:#F8F8F2;">, [</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> ctx.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;schedule&#39;</span><span style="color:#F8F8F2;">, { id: [</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">] })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 当然 Koishi ORM 也支持了 mongo 的正则写法</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> ctx.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;schedule&#39;</span><span style="color:#F8F8F2;">, { command:</span><span style="color:#E6DB74;"> /echo</span><span style="color:#AE81FF;">.</span><span style="color:#F92672;">*</span><span style="color:#E6DB74;">/</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 获取名为 schedule 的表中 id 大于 2 但是小于等于 5 的数据行</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> ctx.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;schedule&#39;</span><span style="color:#F8F8F2;">, { id: { $gt: </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">, $lte: </span><span style="color:#AE81FF;">5</span><span style="color:#F8F8F2;"> } })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 获取名为 schedule 的表中</span></span>
<span class="line"><span style="color:#88846F;">// id 大于 2 但是小于等于 5 或者 id 大于 100 的数据行</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> ctx.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;schedule&#39;</span><span style="color:#F8F8F2;">, {</span></span>
<span class="line"><span style="color:#F8F8F2;">  id: { $gt: </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">, $lte: </span><span style="color:#AE81FF;">5</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">  $or: [{ $id: { $gt: </span><span style="color:#AE81FF;">100</span><span style="color:#F8F8F2;"> } }],</span></span>
<span class="line"><span style="color:#F8F8F2;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 只获取 id 和 command 字段（默认情况下将获取全部字段）</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> ctx.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;schedule&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, [</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;command&#39;</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="db-remove-table-query" tabindex="-1"><a class="header-anchor" href="#db-remove-table-query" aria-hidden="true">#</a> db.remove(table, query)</h3><ul><li><strong>table:</strong> <code>keyof Tables</code> 注册在 ORM 中的表名</li><li><strong>query:</strong> <code>QueryExpr&lt;Tables[T]&gt; | QueryShorthand</code> 搜索表达式</li><li>返回值: <code>Promise&lt;void&gt;</code></li></ul><p><a href="/v3/guide/database.html#%E8%8E%B7%E5%8F%96%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE" class="">删除</a> 数据库中的数据。</p><h3 id="db-create-table-data" tabindex="-1"><a class="header-anchor" href="#db-create-table-data" aria-hidden="true">#</a> db.create(table, data)</h3><ul><li><strong>table:</strong> <code>keyof Tables</code> 注册在 ORM 中的表名</li><li><strong>data:</strong> <code>Partial&lt;TableType&gt;</code> 前一个参数 <code>table</code> 所对应的数据库的数据结构</li><li>返回值: <code>Promise&lt;TableType&gt;</code> 添加行的完整数据</li></ul><p>向数据库中 <a href="/v3/guide/database.html#%E6%B7%BB%E5%8A%A0%E5%92%8C%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE" class="">添加</a> 数据。</p><h3 id="db-update-table-data-key" tabindex="-1"><a class="header-anchor" href="#db-update-table-data-key" aria-hidden="true">#</a> db.update(table, data, key?)</h3><ul><li><strong>table:</strong> <code>keyof Tables</code> 注册在 ORM 中的表名</li><li><strong>data:</strong> <code>Partial&lt;TableType&gt;[]</code> 前一个参数 <code>table</code> 所对应的数据库的数据结构所构成的数组</li><li><strong>key:</strong> <code>Query.Index&lt;table&gt;</code> 以非主键来索引要修改的数据作为参考的字段</li><li>返回值: <code>Promise&lt;void&gt;</code></li></ul><p>向数据库中 <a href="/v3/guide/database.html#%E6%B7%BB%E5%8A%A0%E5%92%8C%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE" class="">更新</a> 数据。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><ul><li>不提供 <code>key</code> 参数时，<code>data</code> 数组中的每个元素都需要包含主键（一般为 <code>id</code>）</li><li>提供 <code>key</code> 参数时， <code>data</code> 数组中的每个元素都需要包含 <code>key</code> 字段。</li></ul></div><h2 id="数据库方法" tabindex="-1"><a class="header-anchor" href="#数据库方法" aria-hidden="true">#</a> 数据库方法</h2><h3 id="db-getuser-type-id-modifier" tabindex="-1"><a class="header-anchor" href="#db-getuser-type-id-modifier" aria-hidden="true">#</a> db.getUser(type, id, modifier?)</h3><ul><li><strong>type:</strong> <code>string</code> 平台名</li><li><strong>id:</strong> <code>string | string[]</code> 用户标识符</li><li><strong>modifier:</strong> <code>QueryModifier&lt;User.Field&gt;</code> 请求修饰符</li><li>返回值: <code>Promise&lt;User | User[]&gt;</code> 用户数据</li></ul><p>向数据库请求用户数据。如果传入的 id 是一个列表，则返回值也应当是一个列表。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>尽管这里我们提供了 <code>fields</code> 参数用于对特定的数据库进行优化，但是如果你是数据库开发者，也完全可以忽略这个参数。只需要保证返回的数据满足用户数据格式，且包含在 <code>fields</code> 中的字段都存在即可。</p></div><h3 id="db-setuser-type-id-data" tabindex="-1"><a class="header-anchor" href="#db-setuser-type-id-data" aria-hidden="true">#</a> db.setUser(type, id, data)</h3><ul><li><strong>type:</strong> <code>string</code> 平台名</li><li><strong>id:</strong> <code>string</code> 用户标识符</li><li><strong>data:</strong> <code>User</code> 要修改 / 添加的数据</li><li>返回值: <code>Promise&lt;void&gt;</code></li></ul><p>向数据库修改或添加用户数据。</p><h3 id="db-getchannel-type-id-modifier" tabindex="-1"><a class="header-anchor" href="#db-getchannel-type-id-modifier" aria-hidden="true">#</a> db.getChannel(type, id, modifier?)</h3><ul><li><strong>type:</strong> <code>string</code> 平台名</li><li><strong>id:</strong> <code>string | string[]</code> 频道标识符</li><li><strong>modifier:</strong> <code>QueryModifier&lt;keyof Channel&gt;</code> 请求修饰符</li><li>返回值: <code>Promise&lt;Channel | Channel[]&gt;</code> 频道数据</li></ul><p>向数据库请求频道数据。如果传入的 id 是一个列表，则返回值也应当是一个列表。</p><h3 id="db-getassignedchannels-fields-type-assignees" tabindex="-1"><a class="header-anchor" href="#db-getassignedchannels-fields-type-assignees" aria-hidden="true">#</a> db.getAssignedChannels(fields?, type?, assignees?) <span class="badge danger" style=""><!--[-->deprecated<!--]--></span></h3><ul><li><strong>fields:</strong> <code>ChannelField[]</code> 请求的字段，默认为全部字段</li><li><strong>type:</strong> <code>string</code> 平台名，默认为全平台</li><li><strong>assignees:</strong> <code>string[]</code> 代理者列表，默认为当前运行的全部机器人</li><li>返回值: <code>Promise&lt;Channel[]&gt;</code> 频道数据列表</li></ul><p>向数据库请求被特定机器人管理的所有频道数据。这里的两个参数可以写任意一个，都可以识别。</p><h3 id="db-setchannel-type-id-data" tabindex="-1"><a class="header-anchor" href="#db-setchannel-type-id-data" aria-hidden="true">#</a> db.setChannel(type, id, data)</h3><ul><li><strong>type:</strong> <code>string</code> 平台名</li><li><strong>id:</strong> <code>number</code> 频道标识符</li><li><strong>data:</strong> <code>Channel</code> 要修改 / 添加的数据</li><li>返回值: <code>Promise&lt;void&gt;</code></li></ul><p>向数据库修改或添加频道数据。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/koishijs/v3/edit/docs/api/database.md" rel="noopener noreferrer" target="_blank" aria-label="帮助我们改善此页面"><!--[--><!--]--> 帮助我们改善此页面 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">12/4/2021, 4:48:57 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: i.dlist@outlook.com">i&#39;DLisT</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: shigma10826@gmail.com">Shigma</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/v3/api/segment.html" class="nav-link" aria-label="消息段 (Segment)"><!--[--><!--]--> 消息段 (Segment) <!--[--><!--]--></a></span><span class="next"><a href="/v3/api/adapter.html" class="nav-link" aria-label="适配器 (Adapter)"><!--[--><!--]--> 适配器 (Adapter) <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/v3/assets/app.9e111ae1.js" defer></script>
  </body>
</html>
